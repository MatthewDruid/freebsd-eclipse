#!/bin/sh
#set -x
#
# Copy distfiles from git.eclipse.org
#
HTTP_BASE="https://codeload.github.com"

if [ ! -x bin/$(basename $0) ]
then
	echo "ERROR: Run this from top level"
	exit 1
fi
. ./config.sh

mkdir -p distfiles
for M in ${ECLIPSE_TOP} ${ECLIPSE_MODULES}
do
	PROJECT=$(dirname $M)
	REPO=$(basename $M | cut -f1 -d:)
	FILE="${REPO}-${ECLIPSE_TAG}.tar.gz"
	if [ -r distfiles/${FILE} ]
	then
		echo "INFO: ${PROJECT}/${FILE} present."
	else
		echo "INFO: Fetching ${PROJECT}/${FILE}"
		fetch --retry $* -o distfiles/${FILE} ${HTTP_BASE}/${PROJECT}/${REPO}/tar.gz/${ECLIPSE_TAG}?dummy=/
	fi
done

#
# Misc files
#
FETCH_MISC="http://opensource.spotify.com/cefbuilds/${CEF_FILE}.tar.bz2"
for M in ${FETCH_MISC}
do
	FILE=$(basename $M)
	if [ -r distfiles/${FILE} ]
	then
		echo "INFO: ${FILE} present."
	else
		fetch --retry $* -o distfiles ${M}
	fi
done
