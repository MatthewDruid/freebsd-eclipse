#!/bin/sh
#set -x
#
# Copy distfiles from git.eclipse.org
#
HTTP_BASE="https://codeload.github.com"

if [ ! -x bin/$(basename $0) ]
then
	echo "ERROR: Run this from top level"
	exit 1
fi
. ./config.sh

mkdir -p distfiles
for M in ${ECLIPSE_TOP} ${ECLIPSE_MODULES}
do
	PROJECT=$(dirname $M)
	REPO=$(basename $M | cut -f1 -d: | cut -f1 -d@)
	TAG=$(basename $M | cut -f1 -d: | cut -f2 -d@)
	if [ ${TAG} = ${REPO} ]
	then
		TAG=${ECLIPSE_TAG}
	fi

	FILE="${REPO}-${TAG}.tar.gz"
	if [ -r distfiles/${FILE} ]
	then
		echo "INFO: ${PROJECT}/${FILE} present."
	else
		echo "INFO: Fetching ${PROJECT}/${FILE}"
		fetch --retry $* -o distfiles/${FILE} ${HTTP_BASE}/${PROJECT}/${REPO}/tar.gz/${TAG}?dummy=/
	fi
done
